<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Nod!</title>
    <style>
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent;
        }
        html, body { 
            width: 100%; 
            height: 100%; 
            overflow: hidden;
            position: fixed;
            overscroll-behavior: none;
            touch-action: none;
        }
        body { 
            font-family: Arial, sans-serif; 
            background: linear-gradient(#ff6b6b, #feca57);
            text-align: center;
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: space-around;
        }
        #word { 
            font-size: clamp(3em, 10vw, 5em); 
            font-weight: bold; 
            color: white; 
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5); 
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        select, button { 
            font-size: 1.2em; 
            padding: 12px 20px; 
            margin: 5px; 
            border-radius: 10px; 
            border: none; 
            background: white; 
            cursor: pointer;
            touch-action: manipulation;
        }
        .preset-btn.active { background: #4ecdc4; color: white; font-weight: bold; }
        #timer { font-size: 2.5em; color: white; font-weight: bold; }
        #score { font-size: 1.8em; color: white; margin: 5px; }
        .presets { display: flex; justify-content: center; gap: 8px; flex-wrap: wrap; }
        #orientationWarning {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.9);
            color: white;
            font-size: 2em;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        #orientationWarning.show { display: flex; }
        .rotate-icon { font-size: 4em; margin-bottom: 20px; }
    </style>
    <script>
        let words = {
            allatok: ['kutya', 'macska', 'oroszl√°n', 'pingvin', 'k√≠gy√≥', 'mad√°r', 'hal', 'r√≥ka', 'elef√°nt', 'tekn≈ës'],
            szineszek: ['Tom Cruise', 'Johnny Depp', 'Emma Watson', 'Dwayne Johnson', 'Margot Robbie', 'Brad Pitt'],
            filmek: ['Csillagok h√°bor√∫ja', 'Titanic', 'J√©gvar√°zs', 'Avengers', 'Harry Potter', 'P√°n P√©ter'],
            tevekenysegek: ['fut√°s', 't√°nc', '√©nekel√©s', 'ugr√°l√°s', 'ev√©s', 'alud√°s', '√∫sz√°s', 'olvas√°s']
        };
        let currentWords = []; 
        let score = 0; 
        let timeLeft = 60; 
        let gameTimer = null; 
        let gameRunning = false; 
        let maxTime = 60;
        let lastTiltTime = 0;
        let initialGamma = null;
        const audioCtx = new (window.AudioContext || window.webkitAudioContext || (() => {}))();
        const TILT_THRESHOLD = 35;
        const DEBOUNCE_MS = 900;

        // G√∂rget√©s tilt√°sa
        document.addEventListener('touchmove', (e) => e.preventDefault(), { passive: false });
        document.addEventListener('gesturestart', (e) => e.preventDefault());

        window.onload = () => {
            document.querySelectorAll('.preset-btn').forEach(btn => btn.onclick = selectPreset);
            document.getElementById('startBtn').onclick = startGame;
            selectPreset({target: document.querySelector('.preset-btn')});
            checkOrientation();
            window.addEventListener('orientationchange', checkOrientation);
            screen.orientation?.addEventListener('change', checkOrientation);
        };

        function checkOrientation() {
            const isLandscape = window.innerWidth > window.innerHeight;
            const warning = document.getElementById('orientationWarning');
            if (!isLandscape) {
                warning.classList.add('show');
                if (gameRunning) {
                    // Sz√ºneteltet√©s portrait m√≥dban
                    if (gameTimer) clearInterval(gameTimer);
                }
            } else {
                warning.classList.remove('show');
                // Folytat√°s ha j√°t√©k k√∂zben ford√≠tott√°l vissza
                if (gameRunning && !gameTimer) {
                    gameTimer = setInterval(() => {
                        timeLeft--; updateDisplay();
                        if (timeLeft > 0 && timeLeft <= 10) playBeep(1200, 0.05);
                        if (timeLeft <= 0) endGame();
                    }, 1000);
                }
            }
        }

        function selectPreset(e) {
            document.querySelectorAll('.preset-btn').forEach(btn => btn.classList.remove('active'));
            e.target.classList.add('active');
            maxTime = parseInt(e.target.dataset.time);
        }

        function playBeep(frequency, duration) {
            try {
                const oscillator = audioCtx.createOscillator(); 
                const gainNode = audioCtx.createGain();
                oscillator.connect(gainNode); gainNode.connect(audioCtx.destination);
                oscillator.frequency.value = frequency; oscillator.type = 'sine';
                gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
                oscillator.start(audioCtx.currentTime); oscillator.stop(audioCtx.currentTime + duration);
            } catch(e) {}
        }

        async function startGame() {
            // Ellen≈ërz√©s landscape-re
            if (window.innerWidth <= window.innerHeight) {
                alert('Ford√≠tsd el a telefont fekv≈ë m√≥dba!');
                return;
            }

            // Landscape lock pr√≥ba
            try {
                await screen.orientation?.lock('landscape');
            } catch(e) {
                console.log('Orientation lock nem t√°mogatott');
            }

            if (gameTimer) clearInterval(gameTimer);
            
            if (typeof DeviceOrientationEvent.requestPermission === 'function') {
                const permission = await DeviceOrientationEvent.requestPermission();
                if (permission !== 'granted') return alert('T√°j√©rz√©kel≈ë enged√©ly kell!');
            }
            
            const cat = document.getElementById('category').value;
            currentWords = [...words[cat]];
            score = 0; timeLeft = maxTime; gameRunning = true;
            lastTiltTime = 0; initialGamma = null;
            updateDisplay();
            newWord();
            
            window.addEventListener('deviceorientation', handleOrientation);
            
            gameTimer = setInterval(() => {
                timeLeft--; updateDisplay();
                if (timeLeft > 0 && timeLeft <= 10) playBeep(1200, 0.05);
                if (timeLeft <= 0) endGame();
            }, 1000);
        }

        function handleOrientation(event) {
            if (!gameRunning) return;
            const now = Date.now();
            if (now - lastTiltTime < DEBOUNCE_MS) return;
            
            // Landscape: gamma haszn√°lata (bal/jobb -> el≈ëre/h√°tra billent√©s landscape-ben)
            const gamma = event.gamma; // -90 to 90
            
            if (initialGamma === null) {
                initialGamma = gamma;
                return;
            }
            
            const tiltDifference = gamma - initialGamma;
            
            // Lefele billent√©s (el≈ëre d≈ël landscape-ben, gamma n√∂vekszik): TAL√ÅLAT
            if (tiltDifference > TILT_THRESHOLD) {
                lastTiltTime = now;
                score++;
                playBeep(800, 0.2);
                document.getElementById('word').textContent = '‚úì TAL√ÅLAT!';
                setTimeout(() => {
                    newWord();
                    initialGamma = null;
                }, 500);
            }
            // Felfele billent√©s (h√°tra d≈ël, gamma cs√∂kken): PASSZ
            else if (tiltDifference < -TILT_THRESHOLD) {
                lastTiltTime = now;
                playBeep(400, 0.2);
                document.getElementById('word').textContent = '‚Üí PASSZ';
                setTimeout(() => {
                    newWord();
                    initialGamma = null;
                }, 500);
            }
        }

        function newWord() {
            if (!gameRunning || currentWords.length === 0) return;
            const idx = Math.floor(Math.random() * currentWords.length);
            document.getElementById('word').textContent = currentWords[idx];
        }

        function updateDisplay() {
            document.getElementById('timer').textContent = timeLeft + 's';
            document.getElementById('score').textContent = 'Pont: ' + score;
        }

        function endGame() {
            if (gameTimer) clearInterval(gameTimer);
            gameTimer = null;
            gameRunning = false;
            window.removeEventListener('deviceorientation', handleOrientation);
            document.getElementById('word').textContent = 'K√ñR V√âGE! ' + score + ' pont';
            playBeep(200, 1);
            try {
                screen.orientation?.unlock();
            } catch(e) {}
        }
    </script>
</head>
<body>
    <div id="orientationWarning">
        <div class="rotate-icon">üì± ‚Üª</div>
        <div>Ford√≠tsd el a telefont<br>fekv≈ë m√≥dba!</div>
    </div>
    
    <div class="controls">
        <select id="category">
            <option value="allatok">√Ållatok</option>
            <option value="szineszek">Sz√≠n√©szek</option>
            <option value="filmek">Filmek</option>
            <option value="tevekenysegek">Tev√©kenys√©gek</option>
        </select>
        <div class="presets">
            <button class="preset-btn" data-time="30">30s</button>
            <button class="preset-btn" data-time="45">45s</button>
            <button class="preset-btn active" data-time="60">60s</button>
        </div>
        <button id="startBtn">START</button>
    </div>
    <div id="timer">60s</div>
    <div id="score">Pont: 0</div>
    <div id="word">Ford√≠tsd fekv≈ëre!</div>
</body>
</html>
